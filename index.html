<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πâ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100%;
        }
        html {
            height: 100%;
        }
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="min-h-full">
    <div id="app" class="min-h-full">
        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö -->
        <div id="loginPage" class="min-h-full flex items-center justify-center p-4">
            <div class="glass rounded-2xl p-8 w-full max-w-md">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üå≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πâ</h1>
                    <p class="text-gray-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                </div>
                
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="email" class="block text-gray-700 font-medium mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" id="email" required 
                               class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="password" class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="password" required 
                               class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white font-bold py-3 px-6 rounded-xl hover:from-green-600 hover:to-blue-700 transition duration-300 transform hover:scale-105">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <p class="text-gray-600 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? 
                        <button id="showRegister" class="text-blue-600 hover:text-blue-500 font-medium">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                    </p>
                </div>
                
                <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
                <div id="registerForm" class="hidden mt-6 p-4 glass rounded-xl">
                    <h3 class="text-gray-800 font-bold mb-4">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                    <div class="space-y-4">
                        <input type="email" id="regEmail" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required 
                               class="w-full px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="password" id="regPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required 
                               class="w-full px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button id="registerBtn" 
                                class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                            ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                        </button>
                    </div>
                    <p class="text-gray-600 text-xs mt-2">*‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å nattapongkha838@gmail.com</p>
                </div>
            </div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
        <div id="mainPage" class="hidden min-h-full">
            <!-- Header -->
            <header class="glass border-b border-gray-200 p-4">
                <div class="max-w-7xl mx-auto flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-gray-800">üå≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πâ</h1>
                    <div class="flex space-x-4">
                        <button id="dashboardBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300">
                            üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                        </button>
                        <button id="addPlotBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition duration-300">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button id="userManagementBtn" class="hidden bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition duration-300">
                            üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                        </button>
                        <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300">
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </div>
            </header>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="max-w-7xl mx-auto p-4">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h2>
                    <div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                        <!-- Dashboard cards will be populated here -->
                    </div>
                </div>

                <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á -->
                <div id="plotsList" class="space-y-4">
                    <!-- Plots will be displayed here -->
                </div>
            </div>

            <!-- User Management Page -->
            <div id="userManagementPage" class="hidden max-w-7xl mx-auto p-4">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
                    
                    <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
                    <div id="userStats" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <!-- User stats will be populated here -->
                    </div>
                    
                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
                    <div class="glass rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        <div id="usersList" class="space-y-4">
                            <!-- Users will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Plot Page -->
            <div id="addPlotPage" class="hidden max-w-7xl mx-auto p-4">
                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á -->
                <div class="glass rounded-2xl p-6 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà</h2>
                    
                    <form id="plotForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="plotName" class="block text-gray-700 font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á</label>
                                <input type="text" id="plotName" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="plotArea" class="block text-gray-700 font-medium mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏£‡πà</label>
                                <input type="number" id="plotArea" step="0.01" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="offerPrice" class="block text-gray-700 font-medium mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="offerPrice" step="0.01" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="logWeight" class="block text-gray-700 font-medium mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡πà‡∏≠‡∏ô (‡∏Å‡∏Å.)</label>
                                <input type="number" id="logWeight" step="0.01" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="firewoodWeight" class="block text-gray-700 font-medium mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏°‡πâ‡∏ü‡∏∑‡∏ô (‡∏Å‡∏Å.)</label>
                                <input type="number" id="firewoodWeight" step="0.01" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="logPrice" class="block text-gray-700 font-medium mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πâ‡∏ó‡πà‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                                <input type="number" id="logPrice" step="0.01" value="2.00" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="firewoodPrice" class="block text-gray-700 font-medium mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πâ‡∏ü‡∏∑‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                                <input type="number" id="firewoodPrice" step="0.01" value="1.00" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡πâ‡∏°/‡πÇ‡∏Ñ‡πà‡∏ô -->
                        <div class="glass rounded-xl p-4">
                            <label class="block text-gray-700 font-medium mb-3">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î</label>
                            <div class="space-y-3">
                                <label class="flex items-center text-gray-700">
                                    <input type="radio" name="cuttingMethod" value="fell" class="mr-3">
                                    <span>‡∏•‡πâ‡∏° (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡πà)</span>
                                </label>
                                <input type="number" id="fellPrice" step="0.01" value="3000" placeholder="‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà" 
                                       class="ml-6 px-3 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                
                                <label class="flex items-center text-gray-700">
                                    <input type="radio" name="cuttingMethod" value="cut" class="mr-3">
                                    <span>‡πÇ‡∏Ñ‡πà‡∏ô (‡∏Ñ‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å)</span>
                                </label>
                                <input type="number" id="cutPrice" step="0.01" value="0.12" placeholder="‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å." 
                                       class="ml-6 px-3 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ú‡∏≤/‡πÑ‡∏ñ -->
                        <div class="glass rounded-xl p-4">
                            <label class="block text-gray-700 font-medium mb-3">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏î</label>
                            <div class="space-y-3">
                                <label class="flex items-center text-gray-700">
                                    <input type="checkbox" id="burn" class="mr-3">
                                    <span>‡πÄ‡∏ú‡∏≤</span>
                                </label>
                                <input type="number" id="burnPrice" step="0.01" placeholder="‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà" 
                                       class="ml-6 px-3 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                
                                <label class="flex items-center text-gray-700">
                                    <input type="checkbox" id="plow" class="mr-3">
                                    <span>‡πÑ‡∏ñ</span>
                                </label>
                                <input type="number" id="plowPrice" step="0.01" placeholder="‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà" 
                                       class="ml-6 px-3 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <!-- ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÜ -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="machinePrice" class="block text-gray-700 font-medium mb-2">‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                                <input type="number" id="machinePrice" step="0.01" value="0.12" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="extinguishPrice" class="block text-gray-700 font-medium mb-2">‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏ö (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                                <input type="number" id="extinguishPrice" step="0.01" value="0.06" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="clampPrice" class="block text-gray-700 font-medium mb-2">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏µ‡∏ö (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                                <input type="number" id="clampPrice" step="0.01" value="0.06" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="brokerFee" class="block text-gray-700 font-medium mb-2">‡∏Ñ‡πà‡∏≤‡∏ô‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="brokerFee" step="0.01" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="logTransportPrice" class="block text-gray-700 font-medium mb-2">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡πà‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                                <input type="number" id="logTransportPrice" step="0.01" value="0.18" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="firewoodTransportPrice" class="block text-gray-700 font-medium mb-2">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å‡πÑ‡∏°‡πâ‡∏ü‡∏∑‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                                <input type="number" id="firewoodTransportPrice" step="0.01" value="0.15" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="workDays" class="block text-gray-700 font-medium mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
                                <input type="number" id="workDays" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label for="dailyExpense" class="block text-gray-700 font-medium mb-2">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢/‡∏ß‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="dailyExpense" step="0.01" value="400" required 
                                       class="w-full px-4 py-3 rounded-xl bg-white border border-gray-300 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <button type="submit" 
                                class="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white font-bold py-4 px-6 rounded-xl hover:from-green-600 hover:to-blue-700 transition duration-300 transform hover:scale-105">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á
                        </button>
                    </form>
                </div>
            </div>

            <!-- Footer -->
            <footer class="glass border-t border-gray-200 p-4 mt-8">
                <div class="text-center text-gray-600">
                    &copy; Nattapong Khawnuy | ‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏û‡∏á‡∏®‡πå ‡∏Ç‡∏≤‡∏ß‡∏ô‡∏∏‡πâ‡∏¢
                </div>
            </footer>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCQHC4eKzfx58hRIcoCe_T9-mQ0TP8sdfM",
            authDomain: "natt-wood.firebaseapp.com",
            projectId: "natt-wood",
            storageBucket: "natt-wood.firebasestorage.app",
            messagingSenderId: "933382154771",
            appId: "1:933382154771:web:d3dc315e622fcbb9c7ede6",
            measurementId: "G-HR13T9WFSN"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const mainPage = document.getElementById('mainPage');
        const dashboardPage = document.getElementById('dashboardPage');
        const addPlotPage = document.getElementById('addPlotPage');
        const userManagementPage = document.getElementById('userManagementPage');
        const loginForm = document.getElementById('loginForm');
        const plotForm = document.getElementById('plotForm');
        const showRegisterBtn = document.getElementById('showRegister');
        const registerForm = document.getElementById('registerForm');
        const registerBtn = document.getElementById('registerBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const dashboardBtn = document.getElementById('dashboardBtn');
        const addPlotBtn = document.getElementById('addPlotBtn');
        const userManagementBtn = document.getElementById('userManagementBtn');
        const dashboard = document.getElementById('dashboard');
        const plotsList = document.getElementById('plotsList');
        const userStats = document.getElementById('userStats');
        const usersList = document.getElementById('usersList');

        // Page Navigation
        function showDashboard() {
            dashboardPage.classList.remove('hidden');
            addPlotPage.classList.add('hidden');
            userManagementPage.classList.add('hidden');
        }

        function showAddPlot() {
            dashboardPage.classList.add('hidden');
            addPlotPage.classList.remove('hidden');
            userManagementPage.classList.add('hidden');
        }

        function showUserManagement() {
            dashboardPage.classList.add('hidden');
            addPlotPage.classList.add('hidden');
            userManagementPage.classList.remove('hidden');
            loadUsers();
        }

        // Auth State Observer
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                const canAccess = await checkUserApproval(user);
                
                if (canAccess) {
                    loginPage.classList.add('hidden');
                    mainPage.classList.remove('hidden');
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (user.email === 'nattapongkha838@gmail.com') {
                        userManagementBtn.classList.remove('hidden');
                    } else {
                        userManagementBtn.classList.add('hidden');
                    }
                    
                    showDashboard();
                    loadPlots();
                } else {
                    loginPage.classList.remove('hidden');
                    mainPage.classList.add('hidden');
                }
            } else {
                loginPage.classList.remove('hidden');
                mainPage.classList.add('hidden');
            }
        });

        // Login Form
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                alert('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        });

        // Show Register Form
        showRegisterBtn.addEventListener('click', () => {
            registerForm.classList.toggle('hidden');
        });

        // Register
        registerBtn.addEventListener('click', async () => {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Firestore
                await db.collection('users').doc(user.uid).set({
                    email: user.email,
                    approved: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    role: 'user'
                });
                
                alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö');
                registerForm.classList.add('hidden');
                
                // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                await auth.signOut();
            } catch (error) {
                alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        });

        // Navigation Events
        dashboardBtn.addEventListener('click', showDashboard);
        addPlotBtn.addEventListener('click', showAddPlot);
        userManagementBtn.addEventListener('click', showUserManagement);

        // Logout
        logoutBtn.addEventListener('click', () => {
            auth.signOut();
        });

        // Plot Form
        plotForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const plotData = {
                plotName: document.getElementById('plotName').value,
                plotArea: parseFloat(document.getElementById('plotArea').value) || 0,
                offerPrice: parseFloat(document.getElementById('offerPrice').value),
                logWeight: parseFloat(document.getElementById('logWeight').value),
                firewoodWeight: parseFloat(document.getElementById('firewoodWeight').value),
                logPrice: parseFloat(document.getElementById('logPrice').value),
                firewoodPrice: parseFloat(document.getElementById('firewoodPrice').value),
                cuttingMethod: document.querySelector('input[name="cuttingMethod"]:checked')?.value || '',
                fellPrice: parseFloat(document.getElementById('fellPrice').value) || 0,
                cutPrice: parseFloat(document.getElementById('cutPrice').value) || 0,
                burn: document.getElementById('burn').checked,
                burnPrice: parseFloat(document.getElementById('burnPrice').value) || 0,
                plow: document.getElementById('plow').checked,
                plowPrice: parseFloat(document.getElementById('plowPrice').value) || 0,
                machinePrice: parseFloat(document.getElementById('machinePrice').value),
                extinguishPrice: parseFloat(document.getElementById('extinguishPrice').value),
                clampPrice: parseFloat(document.getElementById('clampPrice').value),
                logTransportPrice: parseFloat(document.getElementById('logTransportPrice').value),
                firewoodTransportPrice: parseFloat(document.getElementById('firewoodTransportPrice').value),
                brokerFee: parseFloat(document.getElementById('brokerFee').value),
                workDays: parseInt(document.getElementById('workDays').value),
                dailyExpense: parseFloat(document.getElementById('dailyExpense').value),
                userId: auth.currentUser.uid
            };

            // Calculate totals
            const calculations = calculateTotals(plotData);
            plotData.calculations = calculations;

            try {
                const editId = plotForm.dataset.editId;
                if (editId) {
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    plotData.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('plots').doc(editId).update(plotData);
                    alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
                    delete plotForm.dataset.editId;
                    const submitBtn = plotForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á';
                } else {
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                    plotData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('plots').add(plotData);
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                }
                
                plotForm.reset();
                loadPlots();
                showDashboard();
            } catch (error) {
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        });

        // Calculate Totals
        function calculateTotals(data) {
            const totalWeight = data.logWeight + data.firewoodWeight;
            
            // ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÑ‡∏°‡πâ
            const logRevenue = data.logWeight * data.logPrice;
            const firewoodRevenue = data.firewoodWeight * data.firewoodPrice;
            const totalRevenue = logRevenue + firewoodRevenue;
            
            // ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
            let cuttingCost = 0;
            if (data.cuttingMethod === 'fell') {
                cuttingCost = data.plotArea * data.fellPrice; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏£‡πà * ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà
            } else if (data.cuttingMethod === 'cut') {
                cuttingCost = totalWeight * data.cutPrice;
            }
            
            const burnCost = data.burn ? (data.plotArea * data.burnPrice) : 0; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏£‡πà * ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà
            const plowCost = data.plow ? (data.plotArea * data.plowPrice) : 0; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏£‡πà * ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà
            const machineCost = totalWeight * data.machinePrice;
            const extinguishCost = totalWeight * data.extinguishPrice;
            const clampCost = totalWeight * data.clampPrice;
            const logTransportCost = data.logWeight * data.logTransportPrice;
            const firewoodTransportCost = data.firewoodWeight * data.firewoodTransportPrice;
            const dailyExpenseCost = data.workDays * data.dailyExpense;
            
            const totalExpenses = cuttingCost + burnCost + plowCost + machineCost + 
                                extinguishCost + clampCost + logTransportCost + 
                                firewoodTransportCost + data.brokerFee + dailyExpenseCost;
            
            const netProfit = totalRevenue - totalExpenses;
            const canAfford = netProfit >= data.offerPrice;
            const maxAffordablePrice = netProfit; // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ
            
            return {
                totalWeight,
                logRevenue,
                firewoodRevenue,
                totalRevenue,
                cuttingCost,
                burnCost,
                plowCost,
                machineCost,
                extinguishCost,
                clampCost,
                logTransportCost,
                firewoodTransportCost,
                dailyExpenseCost,
                totalExpenses,
                netProfit,
                canAfford,
                maxAffordablePrice
            };
        }

        // Load Plots
        async function loadPlots() {
            try {
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° userId)
                const snapshot = await db.collection('plots').get();
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á
                const sortedDocs = snapshot.docs.sort((a, b) => {
                    const aTime = a.data().createdAt;
                    const bTime = b.data().createdAt;
                    if (!aTime) return 1;
                    if (!bTime) return -1;
                    return bTime.toDate() - aTime.toDate();
                });
                
                displayDashboard(sortedDocs);
                displayPlots(sortedDocs);
            } catch (error) {
                console.error('Error loading plots:', error);
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ index ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
                try {
                    const snapshot = await db.collection('plots').get();
                    
                    displayDashboard(snapshot.docs);
                    displayPlots(snapshot.docs);
                } catch (fallbackError) {
                    console.error('Fallback error:', fallbackError);
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏î‡πâ');
                }
            }
        }

        // Display Dashboard
        function displayDashboard(docs) {
            const totalPlots = docs.length;
            const profitablePlots = docs.filter(doc => doc.data().calculations.canAfford).length;
            const unprofitablePlots = totalPlots - profitablePlots;
            
            dashboard.innerHTML = `
                <div class="glass rounded-xl p-6 card-hover">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-blue-600">${totalPlots}</div>
                        <div class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6 card-hover">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600">${profitablePlots}</div>
                        <div class="text-gray-600">‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6 card-hover">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-red-600">${unprofitablePlots}</div>
                        <div class="text-gray-600">‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</div>
                    </div>
                </div>
            `;
        }

        // Display Plots
        async function displayPlots(docs) {
            if (docs.length === 0) {
                plotsList.innerHTML = `
                    <div class="glass rounded-xl p-8 text-center">
                        <div class="text-gray-500 text-lg mb-4">üå≤ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á</div>
                        <p class="text-gray-400 mb-6">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                        <button onclick="showAddPlot()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition duration-300">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á
                        </button>
                    </div>
                `;
                return;
            }
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á
            const userPromises = docs.map(async doc => {
                const data = doc.data();
                let ownerEmail = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                
                try {
                    if (data.userId) {
                        const userDoc = await db.collection('users').doc(data.userId).get();
                        if (userDoc.exists) {
                            ownerEmail = userDoc.data().email;
                        }
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
                
                return { doc, ownerEmail };
            });
            
            const plotsWithOwners = await Promise.all(userPromises);
            
            plotsList.innerHTML = plotsWithOwners.map(({ doc, ownerEmail }) => {
                const data = doc.data();
                const calc = data.calculations;
                const isOwner = data.userId === auth.currentUser.uid;
                
                return `
                    <div class="glass rounded-xl p-6 card-hover" data-plot-id="${doc.id}">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">${data.plotName}</h3>
                                <div class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${data.plotArea || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} ‡πÑ‡∏£‡πà</div>
                                <div class="text-xs text-gray-500 mt-1">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á: ${ownerEmail}</div>
                            </div>
                            <span class="px-3 py-1 rounded-full text-sm font-medium ${calc.canAfford ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}">
                                ${calc.canAfford ? '‚úÖ ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ' : '‚ùå ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'}
                            </span>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-gray-600 text-sm">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏≤‡∏¢</div>
                                <div class="text-gray-800 font-bold text-lg">${data.offerPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-gray-600 text-sm">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡πÑ‡∏°‡πâ</div>
                                <div class="text-green-600 font-bold text-lg">${calc.totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-gray-600 text-sm">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                                <div class="text-red-600 font-bold text-lg">${calc.totalExpenses.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4 mb-4">
                            <div class="text-gray-600 text-sm">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ</div>
                            <div class="font-bold text-2xl ${calc.maxAffordablePrice >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${calc.maxAffordablePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó
                            </div>
                        </div>
                        
                        <div class="text-gray-500 text-sm mb-4">
                            ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏°: ${calc.totalWeight.toLocaleString()} ‡∏Å‡∏Å. | 
                            ‡πÑ‡∏°‡πâ‡∏ó‡πà‡∏≠‡∏ô: ${data.logWeight.toLocaleString()} ‡∏Å‡∏Å. | 
                            ‡πÑ‡∏°‡πâ‡∏ü‡∏∑‡∏ô: ${data.firewoodWeight.toLocaleString()} ‡∏Å‡∏Å.
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="viewPlotDetails('${doc.id}')" 
                                    class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg transition duration-300">
                                üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                            ${(isOwner || auth.currentUser.email === 'nattapongkha838@gmail.com') ? `
                                <button onclick="editPlot('${doc.id}')" 
                                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300">
                                    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                </button>
                                <button onclick="deletePlot('${doc.id}')" 
                                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300">
                                    üóëÔ∏è ‡∏•‡∏ö
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Delete Plot
        async function deletePlot(plotId) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ö‡∏ö inline
            const plotElement = document.querySelector(`[data-plot-id="${plotId}"]`);
            if (!plotElement) return;
            
            const originalContent = plotElement.innerHTML;
            
            plotElement.innerHTML = `
                <div class="glass rounded-xl p-6 border-2 border-red-300 bg-red-50">
                    <div class="text-center">
                        <div class="text-red-600 text-xl mb-4">‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</div>
                        <p class="text-gray-700 mb-6">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏µ‡πâ? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</p>
                        <div class="flex space-x-4 justify-center">
                            <button onclick="confirmDelete('${plotId}')" 
                                    class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition duration-300">
                                üóëÔ∏è ‡∏•‡∏ö‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
                            </button>
                            <button onclick="cancelDelete('${plotId}', \`${originalContent.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)" 
                                    class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-300">
                                ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Confirm Delete
        async function confirmDelete(plotId) {
            try {
                await db.collection('plots').doc(plotId).delete();
                alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                loadPlots();
            } catch (error) {
                alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
                loadPlots(); // ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            }
        }
        
        // Cancel Delete
        function cancelDelete(plotId, originalContent) {
            const plotElement = document.querySelector(`[data-plot-id="${plotId}"]`);
            if (plotElement) {
                plotElement.innerHTML = originalContent;
            }
        }

        // Check User Approval
        async function checkUserApproval(user) {
            if (user.email === 'nattapongkha838@gmail.com') {
                // ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                return true;
            }
            
            try {
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    if (!userData.approved) {
                        alert('‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
                        await auth.signOut();
                        return false;
                    }
                    return true;
                } else {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firestore
                    const isAdmin = user.email === 'nattapongkha838@gmail.com';
                    await db.collection('users').doc(user.uid).set({
                        email: user.email,
                        approved: isAdmin, // ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        role: isAdmin ? 'admin' : 'user'
                    });
                    
                    if (!isAdmin) {
                        alert('‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
                        await auth.signOut();
                        return false;
                    }
                    return true;
                }
            } catch (error) {
                console.error('Error checking user approval:', error);
                return false;
            }
        }

        // Load Users (Admin only)
        async function loadUsers() {
            if (auth.currentUser.email !== 'nattapongkha838@gmail.com') {
                alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ');
                return;
            }
            
            try {
                const snapshot = await db.collection('users').get();
                const docs = snapshot.docs.sort((a, b) => {
                    const aTime = a.data().createdAt;
                    const bTime = b.data().createdAt;
                    if (!aTime) return 1;
                    if (!bTime) return -1;
                    return bTime.toDate() - aTime.toDate();
                });
                
                displayUserStats(docs);
                displayUsers(docs);
            } catch (error) {
                console.error('Error loading users:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ: ' + error.message);
            }
        }

        // Display User Stats
        function displayUserStats(docs) {
            const totalUsers = docs.length;
            const approvedUsers = docs.filter(doc => doc.data().approved).length;
            const pendingUsers = totalUsers - approvedUsers;
            
            userStats.innerHTML = `
                <div class="glass rounded-xl p-6 card-hover">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-blue-600">${totalUsers}</div>
                        <div class="text-gray-600">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6 card-hover">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600">${approvedUsers}</div>
                        <div class="text-gray-600">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6 card-hover">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-orange-600">${pendingUsers}</div>
                        <div class="text-gray-600">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    </div>
                </div>
            `;
        }

        // Display Users
        function displayUsers(docs) {
            usersList.innerHTML = docs.map(doc => {
                const userData = doc.data();
                const userId = doc.id;
                
                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-4 flex justify-between items-center">
                        <div class="flex-1">
                            <div class="font-medium text-gray-800">${userData.email}</div>
                            <div class="text-sm text-gray-500">
                                ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${userData.createdAt ? new Date(userData.createdAt.toDate()).toLocaleDateString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                            </div>
                            <div class="text-sm">
                                <span class="px-2 py-1 rounded-full text-xs ${userData.approved ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'}">
                                    ${userData.approved ? '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' : '‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'}
                                </span>
                                <span class="ml-2 px-2 py-1 rounded-full text-xs ${userData.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">
                                    ${userData.role === 'admin' ? 'üëë ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•' : 'üë§ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ'}
                                </span>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            ${!userData.approved ? `
                                <button onclick="approveUser('${userId}')" 
                                        class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition duration-300">
                                    ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                </button>
                            ` : ''}
                            ${userData.email !== 'nattapongkha838@gmail.com' ? `
                                <button onclick="deleteUser('${userId}')" 
                                        class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition duration-300">
                                    üóëÔ∏è ‡∏•‡∏ö
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Approve User
        async function approveUser(userId) {
            try {
                await db.collection('users').doc(userId).update({
                    approved: true
                });
                alert('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                loadUsers();
            } catch (error) {
                alert('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }

        // Delete User
        async function deleteUser(userId) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    await db.collection('users').doc(userId).delete();
                    alert('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    loadUsers();
                } catch (error) {
                    alert('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
                }
            }
        }

        // Edit Plot
        async function editPlot(plotId) {
            try {
                const doc = await db.collection('plots').doc(plotId).get();
                if (doc.exists) {
                    const data = doc.data();
                    
                    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
                    document.getElementById('plotName').value = data.plotName;
                    document.getElementById('plotArea').value = data.plotArea || '';
                    document.getElementById('offerPrice').value = data.offerPrice;
                    document.getElementById('logWeight').value = data.logWeight;
                    document.getElementById('firewoodWeight').value = data.firewoodWeight;
                    document.getElementById('logPrice').value = data.logPrice;
                    document.getElementById('firewoodPrice').value = data.firewoodPrice;
                    document.getElementById('fellPrice').value = data.fellPrice;
                    document.getElementById('cutPrice').value = data.cutPrice;
                    document.getElementById('burnPrice').value = data.burnPrice;
                    document.getElementById('plowPrice').value = data.plowPrice;
                    document.getElementById('machinePrice').value = data.machinePrice;
                    document.getElementById('extinguishPrice').value = data.extinguishPrice;
                    document.getElementById('clampPrice').value = data.clampPrice;
                    document.getElementById('brokerFee').value = data.brokerFee;
                    document.getElementById('logTransportPrice').value = data.logTransportPrice;
                    document.getElementById('firewoodTransportPrice').value = data.firewoodTransportPrice;
                    document.getElementById('workDays').value = data.workDays;
                    document.getElementById('dailyExpense').value = data.dailyExpense;
                    
                    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å radio button
                    if (data.cuttingMethod) {
                        document.querySelector(`input[name="cuttingMethod"][value="${data.cuttingMethod}"]`).checked = true;
                    }
                    
                    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å checkbox
                    document.getElementById('burn').checked = data.burn;
                    document.getElementById('plow').checked = data.plow;
                    
                    // ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
                    plotForm.dataset.editId = plotId;
                    
                    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°
                    const submitBtn = plotForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = 'üíæ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á';
                    
                    // ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    showAddPlot();
                }
            } catch (error) {
                alert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }

        // View Plot Details
        async function viewPlotDetails(plotId) {
            try {
                const doc = await db.collection('plots').doc(plotId).get();
                if (doc.exists) {
                    const data = doc.data();
                    const calc = data.calculations;
                    
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á
                    let ownerEmail = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    if (data.userId) {
                        try {
                            const userDoc = await db.collection('users').doc(data.userId).get();
                            if (userDoc.exists) {
                                ownerEmail = userDoc.data().email;
                            }
                        } catch (error) {
                            console.error('Error loading owner data:', error);
                        }
                    }
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á modal ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
                    modal.innerHTML = `
                        <div class="glass rounded-2xl p-6 max-w-4xl w-full max-h-full overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏õ‡∏•‡∏á: ${data.plotName}</h2>
                                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
                                    <div class="space-y-2">
                                        <div><span class="font-medium">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á:</span> ${data.plotName}</div>
                                        <div><span class="font-medium">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á:</span> ${ownerEmail}</div>
                                        <div><span class="font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏£‡πà:</span> ${data.plotArea || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} ‡πÑ‡∏£‡πà</div>
                                        <div><span class="font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏≤‡∏¢:</span> ${data.offerPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏°‡πâ</h3>
                                    <div class="space-y-2">
                                        <div><span class="font-medium">‡πÑ‡∏°‡πâ‡∏ó‡πà‡∏≠‡∏ô:</span> ${data.logWeight.toLocaleString()} ‡∏Å‡∏Å.</div>
                                        <div><span class="font-medium">‡πÑ‡∏°‡πâ‡∏ü‡∏∑‡∏ô:</span> ${data.firewoodWeight.toLocaleString()} ‡∏Å‡∏Å.</div>
                                        <div><span class="font-medium">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏°:</span> ${calc.totalWeight.toLocaleString()} ‡∏Å‡∏Å.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÑ‡∏°‡πâ</h3>
                                    <div class="space-y-2">
                                        <div><span class="font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πâ‡∏ó‡πà‡∏≠‡∏ô:</span> ${data.logPrice} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.</div>
                                        <div><span class="font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πâ‡∏ü‡∏∑‡∏ô:</span> ${data.firewoodPrice} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.</div>
                                        <div class="text-green-600 font-bold"><span class="font-medium">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°:</span> ${calc.totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î</h3>
                                    <div class="space-y-2">
                                        ${data.cuttingMethod === 'fell' ? 
                                            `<div><span class="font-medium">‡∏ß‡∏¥‡∏ò‡∏µ:</span> ‡∏•‡πâ‡∏° (${data.fellPrice} ‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà)</div>
                                             <div><span class="font-medium">‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏î:</span> ${calc.cuttingCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>` :
                                            data.cuttingMethod === 'cut' ?
                                            `<div><span class="font-medium">‡∏ß‡∏¥‡∏ò‡∏µ:</span> ‡πÇ‡∏Ñ‡πà‡∏ô (${data.cutPrice} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</div>
                                             <div><span class="font-medium">‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏î:</span> ${calc.cuttingCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>` :
                                            '<div>‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î</div>'
                                        }
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏î</h3>
                                    <div class="space-y-2">
                                        <div><span class="font-medium">‡πÄ‡∏ú‡∏≤:</span> ${data.burn ? `‡πÉ‡∏ä‡πà (${data.burnPrice} ‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà) = ${calc.burnCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó` : '‡πÑ‡∏°‡πà‡πÄ‡∏ú‡∏≤'}</div>
                                        <div><span class="font-medium">‡πÑ‡∏ñ:</span> ${data.plow ? `‡πÉ‡∏ä‡πà (${data.plowPrice} ‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà) = ${calc.plowCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó` : '‡πÑ‡∏°‡πà‡πÑ‡∏ñ'}</div>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ</h3>
                                    <div class="space-y-2">
                                        <div><span class="font-medium">‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á:</span> ${calc.machineCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                        <div><span class="font-medium">‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏ö:</span> ${calc.extinguishCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                        <div><span class="font-medium">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏µ‡∏ö:</span> ${calc.clampCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                        <div><span class="font-medium">‡∏Ñ‡πà‡∏≤‡∏ô‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤:</span> ${data.brokerFee.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å</h3>
                                    <div class="space-y-2">
                                        <div><span class="font-medium">‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡πà‡∏≠‡∏ô:</span> ${calc.logTransportCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                        <div><span class="font-medium">‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å‡πÑ‡∏°‡πâ‡∏ü‡∏∑‡∏ô:</span> ${calc.firewoodTransportCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                                    <div class="space-y-2">
                                        <div><span class="font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô:</span> ${data.workDays} ‡∏ß‡∏±‡∏ô</div>
                                        <div><span class="font-medium">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢/‡∏ß‡∏±‡∏ô:</span> ${data.dailyExpense.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                        <div><span class="font-medium">‡∏£‡∏ß‡∏°:</span> ${calc.dailyExpenseCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 rounded-xl p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="text-center p-4 bg-green-100 rounded-lg">
                                        <div class="text-green-600 font-bold text-xl">${calc.totalRevenue.toLocaleString()}</div>
                                        <div class="text-gray-600 text-sm">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</div>
                                    </div>
                                    <div class="text-center p-4 bg-red-100 rounded-lg">
                                        <div class="text-red-600 font-bold text-xl">${calc.totalExpenses.toLocaleString()}</div>
                                        <div class="text-gray-600 text-sm">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</div>
                                    </div>
                                    <div class="text-center p-4 ${calc.maxAffordablePrice >= 0 ? 'bg-blue-100' : 'bg-red-100'} rounded-lg">
                                        <div class="${calc.maxAffordablePrice >= 0 ? 'text-blue-600' : 'text-red-600'} font-bold text-xl">${calc.maxAffordablePrice.toLocaleString()}</div>
                                        <div class="text-gray-600 text-sm">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ (‡∏ö‡∏≤‡∏ó)</div>
                                    </div>
                                </div>
                                
                                <div class="mt-4 text-center">
                                    <div class="text-lg">
                                        <span class="font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏≤‡∏¢:</span> 
                                        <span class="text-gray-800 font-bold">${data.offerPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                    <div class="mt-2">
                                        <span class="px-4 py-2 rounded-full text-lg font-bold ${calc.canAfford ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}">
                                            ${calc.canAfford ? '‚úÖ ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ' : '‚ùå ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <button onclick="closeModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg transition duration-300">
                                    ‡∏õ‡∏¥‡∏î
                                </button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î modal
                    window.closeModal = function() {
                        document.body.removeChild(modal);
                        delete window.closeModal;
                    };
                    
                    // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            closeModal();
                        }
                    });
                }
            } catch (error) {
                alert('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }

        // Make functions available globally
        window.deletePlot = deletePlot;
        window.confirmDelete = confirmDelete;
        window.cancelDelete = cancelDelete;
        window.editPlot = editPlot;
        window.viewPlotDetails = viewPlotDetails;
        window.approveUser = approveUser;
        window.deleteUser = deleteUser;
        window.showAddPlot = showAddPlot;
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99393c7515f27325',t:'MTc2MTMwNjQxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
